<!DOCTYPE html>
<html>
    <head>
        <title>КРАН</title>
        <meta http-equiv="content-type" content="text/html;charset=utf-8"/>
        <link rel="stylesheet" href="/css/plumb.css">
        <link href="/img/logo_small.png" rel="shortcut icon" type="image/png" />      
        <link href="/css/bootstrap.min.css" rel="stylesheet">
    </head>
    <body onload="initjsPlumb();main();" onKeyDown="hotKey(event)" data-demo-id="statemachine" data-library="dom">

<!-- Navbar -->

        <nav class="navbar navbar-inverse navbar-default navbar-fixed-top">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
        			<table><tr><td><img alt="Brand" src="/img/logo_small.png"></td><td>&nbsp;&nbsp;<b>КРАН<sup>&nbsp;&alpha;</sup></b></td></tr></table>
      			</a>
      <ul class="nav navbar-nav">
        <li class="active" id="btnConstructor">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" onclick="setMode('constructor')">Схема обработки</a>
        </li>
        <li id="btnScreen">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" onclick="setMode('screen')">Визуализатор</a>
        </li>
        <li id="btnLog">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" onclick="setMode('log')">База данных</a>
        </li>
        <li id="btnSettings">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" onclick="setMode('settings')">Контроль состояний</a>
        </li>
      </ul>
                <div class="btn-group pull-right" role="group" aria-label="...">
                    <button onclick="$('#connectedDevices').modal('show')" type="button" class="btn navbar-btn btn-xs btn-info" id="schemesStatus">⊥</button>
                </div>
            </div>
        </nav>

<div class="demo statemachine-demo" id="statemachine-demo"></div>

<nav class="navbar navbar-inverse navbar-default navbar-fixed-bottom" id="constructor-navbar">

  <div class="container">
    <div class="btn-group dropup">
  <button type="button" class="btn btn-default" onclick="newBlock('SRC')"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span>&nbsp;&nbsp;Новый блок</button>
  <button type="button" onclick="getBlocks()" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    <span class="caret"></span>
    <span class="sr-only">Toggle Dropdown</span>
  </button>
  <ul class="dropdown-menu" id="blocks-menu">
    <li role="separator" class="divider"></li>
    <li><a href="#" onclick="newBlock('file')">Из файла</a></li>
  </ul>
</div>

    <button class="btn btn-default navbar-btn" onclick="newBlock('SRC')"><span class="glyphicon glyphicon-save" aria-hidden="true"></span>&nbsp;&nbsp;Сохранить схему</button>
    <button class="btn btn-default navbar-btn" onclick="newBlock('SRC')"><span class="glyphicon glyphicon-open" aria-hidden="true"></span>&nbsp;&nbsp;Загрузить схему</button>
    <button class="btn btn-default navbar-btn" onclick="newBlock('SRC')"><span class="glyphicon glyphicon-console" aria-hidden="true"></span>&nbsp;&nbsp;Установленные схемы</button>

  </div>
</nav>

<!-- Modal -->
<div class="modal fade" id="connectionSettings" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Настройка связи</h4>
      </div>
      <div class="modal-body">
        <table>
        <tr>
        <td>
            <div class="btn-group" data-toggle="buttons" id="inputsFrom">
                <label class="btn btn-primary active">
                <input type="radio" name="options" id="option1" checked>X</label>
            </div>
        </td>
        <td>
            <div class="btn-group" data-toggle="buttons" id="inputsTo">
                <label class="btn btn-primary active">
                <input type="radio" name="options" id="option2" checked>X</label>
            </div>
        </td>
        </tr>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger pull-left" data-dismiss="modal" onclick="deleteConnection()">Удалить связь</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="setConnection()">Подтвердить</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="connectedDevices" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel1">Расчеты идут по схемам:</h4>
      </div>
      <div class="modal-body">
        <table id="deviceTable" class="table table-striped">
        <thead><tr><td>Название</td><td></td><td>Состояние</td><td>Действие</td><td>Удалить</td></tr></thead>
        <tbody id="clients">
        </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <input type="text" class="form-control" id="schemeName" placeholder="имя_схемы" onKeyDown="checkSchemeName(this.value)", onKeyUp="checkSchemeName(this.value)">
        <button type="button" id="schemeInstallButton" class="btn btn-success" onclick="installScheme(0)">Установить схему</button>
      </div>
    </div>
  </div>
</div>

<div id="oscill-container">
<div id="oscilloscope">
</div>

<nav class="navbar navbar-inverse navbar-default navbar-fixed-bottom">
  <div class="container">
    <div class="btn-group" data-toggle="buttons">
        <label class="btn btn-default active" onclick="oscPlay = true;">
            <input type="radio" name="options" id="option3" checked> 
            <span class="glyphicon glyphicon-play" aria-hidden="true"></span>
        </label>
        <label class="btn btn-default" onclick="oscPlay = false;">
            <input type="radio" name="options" id="option4">
            <span class="glyphicon glyphicon-stop" aria-hidden="true"></span>
        </label>
    </div>
    <button type="button" class="btn btn-default" data-toggle="button" aria-pressed="false" onclick="switchOscRec()">
        <span class="glyphicon glyphicon-record" aria-hidden="true"></span>    
    </button>
    <button class="btn btn-default navbar-btn" onclick="clearOsc()"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
  </div>
</nav>
</div>

<div id="log-container">
    <table id="log-table" class="table table-hover">
    <thead>
    <tr class="">
        <td>№</td>
        <td>Код/префикс</td>
        <td>Время</td>
    </tr>
    </thead>
    <tbody id="eventLog">
    </tbody>
    </table>
<nav class="navbar navbar-inverse navbar-default navbar-fixed-bottom">
  <div class="container">
        <button type="button" class="btn btn-default btn-xs" data-toggle="button" aria-pressed="false" onclick="switchLogPlay()">
            <span class="glyphicon glyphicon-pause" aria-hidden="true"></span>    
        </button>
        <button class="btn btn-default navbar-btn btn-xs" onclick="clearLog()"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
  </div>
</nav>
</div>

<div id="settings-container">

<nav class="navbar navbar-inverse navbar-default navbar-fixed-bottom">
  <div class="container">
    <button class="btn btn-success navbar-btn pull-right">Применить</button>
  </div>
</nav>
</div>

<!-- Include scripts -->

        <!-- support lib for bezier stuff -->
        <script src="/js/jsplumb/jsBezier-0.7.js"></script>
        <!-- event adapter -->
        <script src="/js/jsplumb/mottle-0.6.js"></script>
        <!-- geometry functions -->
        <script src="/js/jsplumb/biltong-0.2.js"></script>
        <!-- drag -->
        <script src="/js/jsplumb/katavorio-0.6.js"></script>
        <!-- jsplumb util -->
        <script src="/js/jsplumb/util.js"></script>
        <script src="/js/jsplumb/browser-util.js"></script>
        <!-- main jsplumb engine -->
        <script src="/js/jsplumb/jsPlumb.js"></script>
        <!-- base DOM adapter -->
        <script src="/js/jsplumb/dom-adapter.js"></script>
        <script src="/js/jsplumb/overlay-component.js"></script>
        <!-- endpoint -->
        <script src="/js/jsplumb/endpoint.js"></script>
        <!-- connection -->
        <script src="/js/jsplumb/connection.js"></script>
        <!-- anchors -->
        <script src="/js/jsplumb/anchors.js"></script>
        <!-- connectors, endpoint and overlays  -->
        <script src="/js/jsplumb/defaults.js"></script>
        <!-- bezier connectors -->
        <script src="/js/jsplumb/connectors-bezier.js"></script>
        <!-- state machine connectors -->
        <script src="/js/jsplumb/connectors-statemachine.js"></script>
        <!-- flowchart connectors -->
        <script src="/js/jsplumb/connectors-flowchart.js"></script>
        <!-- SVG renderer -->
        <script src="/js/jsplumb/renderers-svg.js"></script>

        <!-- vml renderer -->
        <script src="/js/jsplumb/renderers-vml.js"></script>

        <!-- common adapter -->
        <script src="/js/jsplumb/base-library-adapter.js"></script>
        <!-- no library jsPlumb adapter -->
        <script src="/js/jsplumb/dom.jsPlumb.js"></script>
        <!--  demo code -->
        <script src="/js/app/client.js"></script>
        <script src="/js/jquery-2.1.4.min.js"></script>
        <script src="/js/flot/jquery.flot.js"></script>
        <script src="/js/flot/jquery.flot.axislabels.js"></script>
        <script src="/js/bootstrap/bootstrap.min.js"></script>
        <script src=""></script><script src="/js/ace-builds/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
      <!-- sockets.io -->
        <script>document.write('<script src="//'+ location.hostname + ':'+location.port+'/socket.io/socket.io.js">\x3C/script>')</script>
        <script type="text/javascript">
        	var bodyScroll;
        	var stdX, stdY, scrX, scrY;

            $( document ).ready(function() {
                initOsc();
            });

            $(document).mousedown(function(e) {
            	if(e.button==0) {
            	bodyScroll = true;
            	stdX = e.clientX;
            	stdY = e.clientY;
            	$("html, body").scrollTop(function(i, v) {
        				scrY = v;
    			});
            	$("html, body").scrollLeft(function(i, v) {
        				scrX = v;
    			});
            	$("html, body").css({"cursor":"move"});
            	}
            });

            $(document).mouseup(function(e) {
            	bodyScroll = false;
            	$("html, body").css({"cursor":"default"});
            });

            $(document).mousemove(function(e) {
            	if(bodyScroll==true) {
    				$("html, body").scrollTop(function(i, v) {
        				var y = e.clientY - stdY;
        				return scrY - y;
    				});
    				$("html, body").scrollLeft(function(i, v) {
        				var x = e.clientX - stdX;
        				return scrX - x;
    				});    				
    			}
			});


        </script>
    </body>
</html>